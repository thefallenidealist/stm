// *************************************** description ********************************************
/*
   140907
   knjiga: 351
   blocking delay
*/
// *************************************** local includes *****************************************
#include "delay.h"
// *************************************** variables **********************************************
volatile uint32_t SysTick_var;	// timer is 24b countdown
volatile uint32_t uptime_us=0;	
//volatile uint64_t uptime_us=0;	// uint64_t now working

/**************************************************************************************************
*  					delay_init(void)						  *
**************************************************************************************************/
void delay_init(void)
{
	if(SysTick_Config(SystemCoreClock / 1000000) !=0)	// tick is 1 us
		while(1);	// error
}

/**************************************************************************************************
*  					delay_us(void)						  *
**************************************************************************************************/
void delay_us(uint32_t us)
{
	SysTick_var = us;
	while(SysTick_var != 0);
}

/**************************************************************************************************
*  					delay_ms(void)						  *
**************************************************************************************************/
void delay_ms(uint32_t ms)
{
	delay_us(1000*ms);
}

/**************************************************************************************************
*  					get_us(void)						  *
**************************************************************************************************/
uint32_t get_us(void)
{
	return uptime_us;
}

/**************************************************************************************************
*  					SysTick_Handler(void)					  *
**************************************************************************************************/
void SysTick_Handler(void)
{
	// IRQ every 1 us
	if(SysTick_var != 0)
	{
		SysTick_var--;
		uptime_us++;
	}
}
